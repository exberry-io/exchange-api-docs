# Trade Report API

## createTradeReport

The `createTradeReport` API is used to create new Trade Report in the exchange.&#x20;

if a `flow=LockedIn` request is valid, a response is received with `tradeId` (system generated unique identifier of a Trade).

if a `flow=AllegedSystemMatch` request is valid, a response is received with `allegedTradeId` (system generated unique identifier of Alleged Trade).&#x20;

An invalid `createTradeReport` request is rejected with an error message.&#x20;



{% hint style="info" %}
qualifier: v1/exchange.market/createTradeReport
{% endhint %}

### **Request**

The request has all fields of Admin API[ Trade Entry](https://documenter.getpostman.com/view/6229811/TzCV3jcq#909a5a9c-3385-43af-9569-ea3168a331e9) except `mpName` for `mpId` and `instrument` for `instrumentId`, and has additional fields below.&#x20;

In case `AllegedSystemMatch`, MPs can populate `parties` and `accountType` only for their side of the trade.

<table><thead><tr><th width="152">Parameter</th><th width="87.33333333333331">Type</th><th>Description</th></tr></thead><tbody><tr><td>flow</td><td>Enum</td><td><p>One of the below options:</p><ul><li>LockedIn - trade is locked-in and no additional action is required from counterparty MP</li><li>AllegedSystemMatch - the trade should be matched by the system with an Alleged Trade reported by the counterparty MP</li></ul></td></tr><tr><td>externalTradeId <code>optional</code></td><td>Long</td><td><p>Unique identifier assigned by the MPs for a trade.<br></p><p>Required for flow=AllegedSystemMatch</p><p>Optional for flow=LockedIn(no functional use, just external id for reference)</p><p></p><p>Value canâ€™t be reused by the reported MP of an alleged trade for the same instrument, to create another alleged trade, only when the alleged trade is Active.</p></td></tr></tbody></table>

### **Response (**&#x4C;ockedIn)

<table><thead><tr><th width="157.66666666666666">Parameter</th><th width="102">Type</th><th>Description</th></tr></thead><tbody><tr><td>tradeId</td><td>Long</td><td>Unique reference generated by the system for the trades</td></tr></tbody></table>



### **Response (**&#x41;llegedSystemMatch)

<table><thead><tr><th width="157.66666666666666">Parameter</th><th width="102">Type</th><th>Description</th></tr></thead><tbody><tr><td>allegedTradeId</td><td>Long</td><td>Unique reference generated by the system for alleged trades</td></tr></tbody></table>

### **Error Codes**

Same as Amin API Trade Entry with the exceptions below.

<table><thead><tr><th width="128">Code</th><th>Message</th></tr></thead><tbody><tr><td>100</td><td><mark style="color:blue;">(NEW v1.41.0)</mark> <code>Party of source = [ConfiguredParty.source] and role=[ConfiguredParty.role] is required on [Side] side</code></td></tr><tr><td>1001</td><td><code>Wrong [FieldName]</code> </td></tr><tr><td>1002</td><td><code>externalTradeId is already in use</code></td></tr><tr><td>1007</td><td><code>Invalid session</code></td></tr><tr><td>1008</td><td><code>Insufficient permissions</code></td></tr><tr><td>1010</td><td><code>Instrument [Instrument] not found</code> or<br><code>[mpName] not found</code></td></tr><tr><td>1011</td><td><code>Permission denied for this instrument</code></td></tr><tr><td>1020</td><td><code>Unsupported counterparty</code> or<br><code>Unsupported flow</code><br><code>Values for [FieldName] not allowed for counterparty side</code></td></tr><tr><td>1032</td><td><code>Party is not allowed</code><br><code>Account not found</code></td></tr></tbody></table>



### Samples

{% tabs %}
{% tab title="Request-LockedIn" %}
{% code overflow="wrap" %}
```json
{
  "d": {
    "instrument": "BBB",
    "type": "Block",
    "flow": "LockedIn",
    "externalTradeId": 10000004,
    "price": 100.96,
    "quantity": 2,
    "buy": {
      "mpName": "JPM-1",
      "accountType": "House",
      "parties": [
        {
          "id": "456",
          "source": "D",
          "role": "38"
        }
      ]
    },
    "sell": {
      "mpName": "JPM-2",
      "accountType": "Client",
      "parties": [
        {
          "id": "123",
          "source": "D",
          "role": "38"
        }
      ]
    }
  },
  "q": "v1/exchange.market/createTradeReport",
  "sid": 1
}
```
{% endcode %}
{% endtab %}

{% tab title="Request-AllegedSystemMatch" %}
{% code overflow="wrap" %}
```json
{
  "d": {
    "instrument": "BBB",
    "type": "Block",
    "flow": "AllegedSystemMatch",
    "externalTradeId": 10000002,
    "price": 100.95,
    "quantity": 2,
    "buy": {
      "mpName": "JPM-1",
      "accountType": "Client",
      "parties": [
        {
          "id": "123",
          "source": "D",
          "role": "38"
        }
      ]
    },
    "sell": {
      "mpName": "JPM-2"
    }
  },
  "q": "v1/exchange.market/createTradeReport",
  "sid": 1
}
```
{% endcode %}
{% endtab %}

{% tab title="Success Response" %}
{% code overflow="wrap" %}
```json
// LockedIn
{
  "q": "v1/exchange.market/createTradeReport",
  "sid": 1,
  "d": {
    "tradeId": 7
  }
}


// AllegedSystemMatch
{
  "q": "v1/exchange.market/createTradeReport",
  "sid": 1,
  "d": {
    "allegedTradeId": 9
  }
}
```
{% endcode %}
{% endtab %}

{% tab title="Failure Response" %}
```json
{
  "sig": 2,
  "q": "v1/exchange.market/createTradeReport",
  "errorType": "500",
  "sid": 1,
  "d": {
    "errorCode": 100,
    "errorMessage": "Missing or invalid parameter: externalTradeId"
  }
}
```
{% endtab %}
{% endtabs %}



## cancelAllegedTradeReport

The `cancelAllegedTradeReport` API is used by the reporting MP to cancel Alleged Trade Reports in the exchange.&#x20;

A response is received with `allegedTradeId` if the request is valid and the cancellation is successful. An invalid `cancelAllegedTradeReport` request is rejected with an error message.&#x20;



{% hint style="info" %}
qualifier: v1/exchange.market/cancelAllegedTradeReport
{% endhint %}

### **Request**

<table><thead><tr><th width="175">Parameter</th><th width="115.33333333333331">Type</th><th>Description</th></tr></thead><tbody><tr><td>instrument</td><td>String</td><td>Instrument symbol</td></tr><tr><td>allegedTradeId<br><code>optional</code></td><td>Long</td><td><p>Same as response of <a href="trade-report-api.md#response-allegedsystemmatch">createTradeReport</a> </p><p>Should not exist if externalTradeId exist</p></td></tr><tr><td>externalTradeId <code>optional</code></td><td>Long</td><td><p>Same as <a href="trade-report-api.md#request">createTradeReport</a> request </p><p>Should not exist if allegedTradeId exist</p></td></tr></tbody></table>

### **Response**

<table><thead><tr><th width="157.66666666666666">Parameter</th><th width="102">Type</th><th>Description</th></tr></thead><tbody><tr><td>allegedTradeId</td><td>Long</td><td>Same as response of <a href="trade-report-api.md#response-allegedsystemmatch">createTradeReport</a> </td></tr></tbody></table>

### **Error Codes**

<table><thead><tr><th width="128">Code</th><th>Message</th></tr></thead><tbody><tr><td>1</td><td><code>Exchange is unavailable</code></td></tr><tr><td>100</td><td><code>Missing or invalid parameter: [FieldName]</code></td></tr><tr><td>102</td><td><code>Instrument trading is not allowed</code> or<br><code>Instrument trading is halt</code> or<br><code>Market is closed</code> or<br><code>Currently not allowed</code> or<br><code>Trading is not allowed during auction call</code> or<br><code>Trading is not allowed during crossing</code> or<br><code>Trading is not allowed</code></td></tr><tr><td>1001</td><td><code>Wrong [FieldName]</code> </td></tr><tr><td>1104</td><td><code>Please use only one from allegedTradeId or externalTradeId</code></td></tr><tr><td>1007</td><td><code>Invalid session</code></td></tr><tr><td>1008</td><td><code>Insufficient permissions</code></td></tr><tr><td>1010</td><td><code>Instrument [Instrument] not found</code></td></tr><tr><td>1011</td><td><code>Permission denied for this instrument</code></td></tr><tr><td>1100</td><td><code>Alleged trade not found for that instrument</code></td></tr></tbody></table>



### Samples

{% tabs %}
{% tab title="Request" %}
{% code overflow="wrap" %}
```json
{
  "d": {
    "instrument": "BBB",
    "allegedTradeId": 9
  },
  "q": "v1/exchange.market/cancelAllegedTradeReport",
  "sid": 1
}
```
{% endcode %}
{% endtab %}

{% tab title="Success Response" %}
{% code overflow="wrap" %}
```json
{
  "q": "v1/exchange.market/cancelAllegedTradeReport",
  "sid": 1,
  "d": {
    "allegedTradeId": 4
  }
}
```
{% endcode %}
{% endtab %}

{% tab title="Failure Response" %}
```json
{
  "sig": 2,
  "q": "v1/exchange.market/cancelAllegedTradeReport",
  "errorType": "500",
  "sid": 1,
  "d": {
    "errorCode": 100,
    "errorMessage": "Missing or invalid parameter: allegedTradeId"
  }
}
```
{% endtab %}
{% endtabs %}



